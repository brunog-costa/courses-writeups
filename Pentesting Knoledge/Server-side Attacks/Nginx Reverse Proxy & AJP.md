
We can create an midleware broker between Apache Tomcat hidden application using our own machine as a reverse proxy.

In order to do so we need to setup the service: 

```shell-session
wget https://nginx.org/download/nginx-1.21.3.tar.gz
$ tar -xzvf nginx-1.21.3.tar.gz
```

```shell-session
git clone https://github.com/dvershinin/nginx_ajp_module.git
$ cd nginx-1.21.3
$ sudo apt install libpcre3-dev
$ ./configure --add-module=`pwd`/../nginx_ajp_module --prefix=/etc/nginx --sbin-path=/usr/sbin/nginx --modules-path=/usr/lib/nginx/modules
$ make
$ sudo make install
$ nginx -V
```

After that we'll need to edit the /etc/nginx/conf/nginx.conf file  creating a new server block (please comment the default server block).

```shell-session
upstream tomcats {
	server <TARGET_SERVER>:8009;
	keepalive 10;
	}
server {
	listen 80;
	location / {
		ajp_keep_conn on;
		ajp_pass tomcats;
	}
}
```

```shell-session
sudo nginx
$ curl http://127.0.0.1:80
```

After that, we'll have a connection with Tomcat ;) 

```shell-session
 sudo apt install libapache2-mod-jk
$ sudo a2enmod proxy_ajp
$ sudo a2enmod proxy_http
$ export TARGET="<TARGET_IP>"
$ echo -n """<Proxy *>
Order allow,deny
Allow from all
</Proxy>
ProxyPass / ajp://$TARGET:8009/
ProxyPassReverse / ajp://$TARGET:8009/""" | sudo tee /etc/apache2/sites-available/ajp-proxy.conf
$ sudo ln -s /etc/apache2/sites-available/ajp-proxy.conf /etc/apache2/sites-enabled/ajp-proxy.conf
$ sudo systemctl start apache2
```

After this final step, we should be able to access tomcat from browser or curl command.